var J=Object.defineProperty;var $=(c,e,t)=>e in c?J(c,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):c[e]=t;var h=(c,e,t)=>($(c,typeof e!="symbol"?e+"":e,t),t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))o(r);new MutationObserver(r=>{for(const l of r)if(l.type==="childList")for(const u of l.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&o(u)}).observe(document,{childList:!0,subtree:!0});function t(r){const l={};return r.integrity&&(l.integrity=r.integrity),r.referrerpolicy&&(l.referrerPolicy=r.referrerpolicy),r.crossorigin==="use-credentials"?l.credentials="include":r.crossorigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function o(r){if(r.ep)return;r.ep=!0;const l=t(r);fetch(r.href,l)}})();class Z{constructor(){h(this,"throttleTime",10)}onResizeEvent(e){window.addEventListener("resize",e)}onKeydownEvent(e){window.addEventListener("keydown",e)}onKeyupEvent(e){window.addEventListener("keyup",e)}onKeypressEvent(e){window.addEventListener("keypress",e)}onMouseDownEvent(e){i.canvas.addEventListener("mousedown",e)}onMouseMoveEvent(e){i.canvas.addEventListener("mousemove",this.throttle(e,this.throttleTime))}onMouseUpEvent(e){i.canvas.addEventListener("mouseup",e)}onMouseLeaveEvent(e){i.canvas.addEventListener("mouseleave",e)}onWheelEvent(e){i.canvas.addEventListener("wheel",e)}onTouchStartEvent(e){i.canvas.addEventListener("touchstart",e)}onTouchMoveEvent(e){i.canvas.addEventListener("touchmove",this.throttle(e,this.throttleTime))}onTouchEndEvent(e){i.canvas.addEventListener("touchend",e)}onContextMenuEvent(e){i.canvas.addEventListener("contextmenu",e)}throttle(e,t){let o=!1;return function(r){o||(e.apply(null,[r]),o=!0,setTimeout(function(){o=!1},t))}}}class s{static toScreenX(e){return(e+n.offsetX)*n.scale}static toScreenY(e){return(e+n.offsetY)*n.scale}static toWorldX(e){return e/n.scale-n.offsetX}static toWorldY(e){return e/n.scale-n.offsetY}static getWidth(){return i.canvas.clientWidth/n.scale}static getHeight(){return i.canvas.clientHeight/n.scale}}h(s,"cursorX",0),h(s,"cursorY",0),h(s,"prevCursorX",0),h(s,"prevCursorY",0),h(s,"prevTouches",[null,null]);class j{constructor(e){h(this,"properties");h(this,"type",f.Circle);h(this,"worldCenterX");h(this,"worldCenterY");h(this,"radiusX");h(this,"radiusY");this.properties=e,this.worldCenterX=0,this.worldCenterY=0,this.radiusX=0,this.radiusY=0}startDraw(e){i.ctx.strokeStyle=this.properties.strokeColor,i.ctx.fillStyle=this.properties.fillColor,i.ctx.lineWidth=this.properties.lineWidth*n.scale;const t=e instanceof MouseEvent?e.pageX:e.touches[0].pageX,o=e instanceof MouseEvent?e.pageY:e.touches[0].pageY;this.properties.fill=n.fill,this.properties.initialX=t,this.properties.initialY=o}draw(e){i.clearCanvas(),i.reDraw(),i.ctx.beginPath();const t=e instanceof MouseEvent?e.pageX:e.touches[0].pageX,o=e instanceof MouseEvent?e.pageY:e.touches[0].pageY;let r=(t-this.properties.initialX)/2,l=(o-this.properties.initialY)/2;if(i.isPerfectShape){const p=Math.min(Math.abs(r),Math.abs(l)),w=r<0?-1:1,g=l<0?-1:1;r=p*w,l=p*g}let u=this.properties.initialX+r,d=this.properties.initialY+l;r=Math.abs(r),l=Math.abs(l),this.worldCenterX=s.toWorldX(u),this.worldCenterY=s.toWorldY(d),this.radiusX=r/n.scale,this.radiusY=l/n.scale,i.ctx.ellipse(u,d,r,l,0,0,2*Math.PI),this.properties.fill?i.ctx.fill():i.ctx.stroke(),i.ctx.closePath()}reDraw(){i.ctx.strokeStyle=this.properties.strokeColor,i.ctx.lineWidth=this.properties.lineWidth*n.scale,i.ctx.ellipse(s.toScreenX(this.worldCenterX),s.toScreenY(this.worldCenterY),this.radiusX*n.scale,this.radiusY*n.scale,0,0,2*Math.PI),this.properties.fill?i.ctx.fill():i.ctx.stroke()}cancelDraw(){i.clearCanvas(),i.reDraw()}endDraw(){i.ctx.closePath()}isEmpty(){return this.radiusX===0&&this.radiusY===0}}class W{constructor(e){h(this,"line");h(this,"initialRealX");h(this,"initialRealY");h(this,"properties");h(this,"type",f.HandDrawing);this.line=[],this.initialRealX=0,this.initialRealY=0,this.properties=e}cancelDraw(){this.line=[]}startDraw(e){i.ctx.strokeStyle=this.properties.strokeColor,i.ctx.lineWidth=this.properties.lineWidth*n.scale,i.ctx.beginPath();const t=e instanceof MouseEvent?e.pageX:e.touches[0].pageX,o=e instanceof MouseEvent?e.pageY:e.touches[0].pageY;this.properties.initialX=t,this.properties.initialY=o,this.initialRealX=s.toWorldX(t),this.initialRealY=s.toWorldY(o)}draw(e){const t=e instanceof MouseEvent?e.pageX:e.touches[0].pageX,o=e instanceof MouseEvent?e.pageY:e.touches[0].pageY;if(i.clearCanvas(),i.reDraw(),i.ctx.beginPath(),i.isPerfectShape)i.ctx.moveTo(this.properties.initialX,this.properties.initialY),i.ctx.lineTo(t,o);else{let r=[this.initialRealX,this.initialRealY];this.line.push([s.toWorldX(t),s.toWorldY(o)]);let l=this.line[0];for(let u=1;u<this.line.length;u++){let d=this.midPoint(r,l);i.ctx.quadraticCurveTo(s.toScreenX(r[0]),s.toScreenY(r[1]),s.toScreenX(d[0]),s.toScreenY(d[1])),r=this.line[u],l=this.line[u+1]}}i.ctx.stroke(),i.ctx.closePath()}midPoint(e,t){return[e[0]+(t[0]-e[0])/2,e[1]+(t[1]-e[1])/2]}reDraw(){if(this.line.length>2){i.ctx.beginPath();let e=[this.initialRealX,this.initialRealY],t=this.line[0];i.ctx.moveTo(s.toScreenX(this.initialRealX),s.toScreenY(this.initialRealY));for(let o=1;o<this.line.length;o++){let r=this.midPoint(e,t);i.ctx.quadraticCurveTo(s.toScreenX(e[0]),s.toScreenY(e[1]),s.toScreenX(r[0]),s.toScreenY(r[1])),e=this.line[o],t=this.line[o+1]}i.ctx.stroke(),i.ctx.closePath()}else{for(let e=0;e<this.line.length;e++)i.ctx.lineTo(s.toScreenX(this.line[e][0]),s.toScreenY(this.line[e][1]));i.ctx.stroke()}}endDraw(e){if(i.isPerfectShape){const t=e instanceof MouseEvent?e.pageX:e.changedTouches[0].pageX,o=e instanceof MouseEvent?e.pageY:e.changedTouches[0].pageY;this.line=[];const r=[s.toWorldX(t),s.toWorldY(o)];this.line.push([s.toWorldX(this.properties.initialX),s.toWorldY(this.properties.initialY)]),this.line.push(r)}this.line.length>2&&(this.line=this.normalizeArray(this.line)),i.ctx.closePath()}isEmpty(){return this.line.length===0}normalizeArray(e){let t=[];return t=e.filter((o,r)=>{if(r===0)return!0;if(r===e.length-1)return!1;const l=e[r-1];return!(l[0]===o[0]||l[1]===o[1])}),t.push([e[e.length-1][0],e[e.length-1][1]]),t}}class F{constructor(e){h(this,"properties");h(this,"type",f.Rectangle);h(this,"initialRealX");h(this,"initialRealY");h(this,"width");h(this,"height");this.properties=e,this.initialRealX=0,this.initialRealY=0,this.width=0,this.height=0}startDraw(e){i.ctx.strokeStyle=this.properties.strokeColor,i.ctx.fillStyle=this.properties.fillColor,i.ctx.lineWidth=this.properties.lineWidth*n.scale;const t=e instanceof MouseEvent?e.pageX:e.touches[0].pageX,o=e instanceof MouseEvent?e.pageY:e.touches[0].pageY;this.properties.fill=n.fill,this.properties.initialX=t,this.properties.initialY=o,this.initialRealX=s.toWorldX(t),this.initialRealY=s.toWorldY(o)}draw(e){i.clearCanvas(),i.reDraw(),i.ctx.beginPath();const t=e instanceof MouseEvent?e.pageX:e.touches[0].pageX,o=e instanceof MouseEvent?e.pageY:e.touches[0].pageY;let r=t-this.properties.initialX,l=o-this.properties.initialY;if(i.isPerfectShape){const u=Math.min(Math.abs(r),Math.abs(l));let d=l<0?-1:1,p=r<0?-1:1;r=u*p,l=u*d}this.width=r/n.scale,this.height=l/n.scale,this.properties.fill?i.ctx.fillRect(this.properties.initialX,this.properties.initialY,r,l):i.ctx.rect(this.properties.initialX,this.properties.initialY,r,l),i.ctx.stroke(),i.ctx.closePath()}reDraw(){i.ctx.strokeStyle=this.properties.strokeColor,i.ctx.lineWidth=this.properties.lineWidth*n.scale,this.properties.fill?i.ctx.fillRect(s.toScreenX(this.initialRealX),s.toScreenY(this.initialRealY),this.width*n.scale,this.height*n.scale):i.ctx.rect(s.toScreenX(this.initialRealX),s.toScreenY(this.initialRealY),this.width*n.scale,this.height*n.scale),i.ctx.stroke()}cancelDraw(){i.clearCanvas(),i.reDraw()}endDraw(){i.ctx.closePath()}isEmpty(){return this.width===0&&this.height===0}}class T{static create(e,t={}){switch(e){case f.HandDrawing:return new W(t);case f.Rectangle:return new F(t);case f.Circle:return new j(t);default:return new W(t)}}}var f=(c=>(c.HandDrawing="HandDrawing",c.Rectangle="Rectangle",c.Circle="Circle",c))(f||{});const k=document.getElementById("color"),D=document.getElementById("size"),R=D.nextElementSibling,P=document.getElementById("drawables"),G=document.getElementById("fill"),Q=(c,e)=>{let t=c.parentElement;for(;t!==null;){if(t.tagName===e)return t;t=t.parentElement}return c},V=()=>{const c=localStorage.getItem("history");c!==null&&(JSON.parse(c).forEach(t=>{const o=t.type,r=T.create(o);Object.assign(r,t),i.history.push(r)}),i.reDraw())},v=()=>{localStorage.setItem("history",JSON.stringify(i.history))},L={strokeColor:"#000000",lineWidth:10,fillColor:"#000000",fill:!1,currentDrawable:"HandDrawing",offsetX:0,offsetY:0,scale:1},n=new Proxy(L,{get:(c,e)=>c[e],set:(c,e,t)=>{switch(e){case"offsetX":case"offsetY":case"scale":c[e]=t;break;case"strokeColor":c.strokeColor=t,k.value=t,i.ctx.strokeStyle=t;break;case"lineWidth":c.lineWidth=t,D.value=t,R.value=t,i.ctx.lineWidth=t;break;case"fillColor":c.fillColor=t,i.ctx.fillStyle=t;break;case"fill":c.fill=t;break;case"currentDrawable":c.currentDrawable=t,te();break}return ee(),!0}}),_=()=>{i.ctx.lineJoin="round",i.ctx.lineCap="round";const c=localStorage.getItem("config");if(c!==null){const e=JSON.parse(c);Object.assign(n,e)}},ee=()=>{localStorage.setItem("config",JSON.stringify(L))},te=()=>{P.childNodes.forEach(c=>{if(c.nodeType===Node.ELEMENT_NODE){const e=c;e.classList.remove("selected_draw"),e.dataset.type===n.currentDrawable&&e.classList.add("selected_draw")}})},ie=()=>{D.addEventListener("input",e=>{const t=e.target;n.lineWidth=Number(t.value)}),R.addEventListener("input",e=>{const t=e.target;if(Number(t.value)>50){n.lineWidth=50;return}else if(Number(t.value)<1){n.lineWidth=1;return}n.lineWidth=Number(t.value)}),k.addEventListener("change",({target:e})=>{n.strokeColor=e.value,n.fillColor=e.value}),G.addEventListener("change",({target:e})=>{n.fill=e.checked}),document.getElementById("clear").addEventListener("click",()=>{i.clearBoard()}),document.getElementById("reset").addEventListener("click",()=>{n.offsetX=0,n.offsetY=0,n.scale=1,i.reDraw()}),document.getElementById("undo").addEventListener("click",()=>{i.undo()});const c=document.getElementById("download");c.addEventListener("click",()=>{c.setAttribute("download","image.png"),c.setAttribute("href",i.canvas.toDataURL("image/png"))}),P.addEventListener("click",e=>{let t=e.target;t.tagName!=="BUTTON"&&(t=Q(t,"BUTTON"));const o=t.dataset.type;o!==void 0&&(n.currentDrawable=o)}),window.addEventListener("load",()=>{_(),V()})},a=class extends Z{constructor(){super();h(this,"isDrawing");h(this,"isDragging");h(this,"timer",0);h(this,"currentDraw",null);a.canvas=document.getElementById("canvas"),a.ctx=a.canvas.getContext("2d"),a.canvas.width=document.body.clientWidth,a.canvas.height=document.body.clientHeight,this.isDrawing=!1,this.isDragging=!1,this.createDrawable(),a.clearCanvas()}initilizeEvents(){this.onResizeEvent(this.onResize.bind(this)),this.onMouseDownEvent(this.onMouseDown.bind(this)),this.onMouseMoveEvent(this.onMouseMove.bind(this)),this.onMouseUpEvent(this.onMouseUp.bind(this)),this.onMouseLeaveEvent(this.onMouseUp.bind(this)),this.onContextMenuEvent(this.onContextMenu.bind(this)),this.onWheelEvent(this.onMouseWheel.bind(this)),this.onTouchStartEvent(this.onTouchStart.bind(this)),this.onTouchMoveEvent(this.onTouchMove.bind(this)),this.onTouchEndEvent(this.onTouchEnd.bind(this)),this.onKeydownEvent(this.onKeyDown.bind(this)),ie()}onContextMenu(t){t.preventDefault()}onResize(){a.canvas.width=document.body.clientWidth,a.canvas.height=document.body.clientHeight,a.reDraw()}static reDraw(){a.history.length!=0&&(a.clearCanvas(),a.history.forEach(t=>{a.ctx.strokeStyle=t.properties.strokeColor,a.ctx.fillStyle=t.properties.strokeColor,a.ctx.lineWidth=t.properties.lineWidth*n.scale,a.ctx.moveTo(t.properties.initialX,t.properties.initialY),a.ctx.beginPath(),t.reDraw(),a.ctx.closePath()}),a.ctx.strokeStyle=n.strokeColor,a.ctx.lineWidth=n.lineWidth*n.scale)}draw(t){var o;this.isDrawing&&(clearTimeout(this.timer),a.isPerfectShape||(this.timer=setTimeout(()=>{var r;a.isPerfectShape=!0,(r=this.currentDraw)==null||r.draw(t)},600)),(o=this.currentDraw)==null||o.draw(t))}endDraw(t){var o,r;this.isDrawing&&((o=this.currentDraw)==null||o.endDraw(t),(r=this.currentDraw)!=null&&r.isEmpty()||(a.history.push(this.currentDraw),v())),this.isDrawing=!1,this.isDragging=!1,a.isPerfectShape=!1,clearTimeout(this.timer)}onMouseDown(t){var o;t.preventDefault(),this.isDrawing=t.button==0,this.isDragging=t.button==1,s.cursorX=t.pageX,s.cursorY=t.pageY,s.prevCursorX=t.pageX,s.prevCursorY=t.pageY,this.isDrawing&&(this.createDrawable(),(o=this.currentDraw)==null||o.startDraw(t))}onMouseMove(t){s.cursorX=t.pageX,s.cursorY=t.pageY,this.draw(t),this.isDragging&&(n.offsetX+=(s.cursorX-s.prevCursorX)/n.scale,n.offsetY+=(s.cursorY-s.prevCursorY)/n.scale,a.reDraw()),s.prevCursorX=s.cursorX,s.prevCursorY=s.cursorY}onMouseUp(t){this.endDraw(t)}onMouseWheel(t){var Y;if(this.isDrawing){(Y=this.currentDraw)==null||Y.cancelDraw(),this.createDrawable(),this.isDrawing=!1,this.isDragging=!1;return}const r=-t.deltaY/500,l=n.scale*(1+r);if(l<.1||l>10)return;n.scale=l;var u=t.pageX/a.canvas.clientWidth,d=t.pageY/a.canvas.clientHeight;const p=s.getWidth()*r,w=s.getHeight()*r,g=p*u,X=w*d;n.offsetX-=g,n.offsetY-=X,a.reDraw()}onTouchStart(t){var o;this.isDrawing=t.touches.length==1,this.isDragging=t.touches.length>=2,s.prevTouches[0]=t.touches[0],s.prevTouches[1]=t.touches[1],this.createDrawable(),(o=this.currentDraw)==null||o.startDraw(t)}onTouchMove(t){var g,X,Y;if(s.prevTouches[0]===null||s.prevTouches[1]===null)return;const o=t.touches[0].pageX,r=t.touches[0].pageY,l=s.prevTouches[0].pageX,u=s.prevTouches[0].pageY;if(this.draw(t),this.isDragging){if(this.isDrawing){(g=this.currentDraw)==null||g.cancelDraw(),this.createDrawable(),this.isDrawing=!1,this.isDragging=!1;return}t.preventDefault();const m=t.touches[1].pageX,E=t.touches[1].pageY,x=(X=s.prevTouches[1])==null?void 0:X.pageX,b=(Y=s.prevTouches[1])==null?void 0:Y.pageY,S=(o+m)/2,M=(r+E)/2,N=(l+x)/2,H=(u+b)/2,I=Math.sqrt(Math.pow(o-m,2)+Math.pow(r-E,2)),O=Math.sqrt(Math.pow(l-x,2)+Math.pow(u-b,2));var d=I/O;const y=n.scale*d;if(y<.1||y>10)return;n.scale=y;const C=1-d,z=S-N,A=M-H;n.offsetX+=z/n.scale,n.offsetY+=A/n.scale;var p=S/a.canvas.clientWidth,w=M/a.canvas.clientHeight;const B=s.getWidth()*C,U=s.getHeight()*C,K=B*p,q=U*w;n.offsetX+=K,n.offsetY+=q,a.reDraw()}s.prevTouches[0]=t.touches[0],s.prevTouches[1]=t.touches[1]}onTouchEnd(t){this.endDraw(t),s.prevTouches[0]=null,s.prevTouches[1]=null}onKeyDown(t){t.ctrlKey&&(t.key===""||t.key==="z")&&a.undo()}static undo(){a.history.length!==0&&(a.clearCanvas(),a.history.pop(),v(),a.reDraw())}static clearBoard(){a.clearCanvas(),a.history=[],v()}createDrawable(){this.currentDraw=T.create(n.currentDrawable,{strokeColor:n.strokeColor,lineWidth:n.lineWidth,fillColor:n.fillColor})}static clearCanvas(t=null){a.ctx.fillStyle="#fff",t===null?a.ctx.fillRect(0,0,document.body.clientWidth,document.body.clientHeight):a.ctx.fillRect(t.prevX,t.prevY,t.x,t.y),a.ctx.fillStyle=n.fillColor}};let i=a;h(i,"canvas"),h(i,"ctx"),h(i,"isPerfectShape",!1),h(i,"history",[]);const se=new i;se.initilizeEvents();

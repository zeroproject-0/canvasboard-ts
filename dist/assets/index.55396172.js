var N=Object.defineProperty;var B=(c,t,n)=>t in c?N(c,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):c[t]=n;var r=(c,t,n)=>(B(c,typeof t!="symbol"?t+"":t,n),n);const K=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))a(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const l of o.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&a(l)}).observe(document,{childList:!0,subtree:!0});function n(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerpolicy&&(o.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?o.credentials="include":s.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function a(s){if(s.ep)return;s.ep=!0;const o=n(s);fetch(s.href,o)}};K();class O{constructor(){r(this,"throttleTime",10)}onResizeEvent(t){window.addEventListener("resize",t)}onKeydownEvent(t){window.addEventListener("keydown",t)}onKeyupEvent(t){window.addEventListener("keyup",t)}onKeypressEvent(t){window.addEventListener("keypress",t)}onMouseDownEvent(t){e.canvas.addEventListener("mousedown",t)}onMouseMoveEvent(t){e.canvas.addEventListener("mousemove",this.throttle(t,this.throttleTime))}onMouseUpEvent(t){e.canvas.addEventListener("mouseup",t)}onMouseLeaveEvent(t){e.canvas.addEventListener("mouseleave",t)}onWheelEvent(t){e.canvas.addEventListener("wheel",t)}onTouchStartEvent(t){e.canvas.addEventListener("touchstart",t)}onTouchMoveEvent(t){e.canvas.addEventListener("touchmove",this.throttle(t,this.throttleTime))}onTouchEndEvent(t){e.canvas.addEventListener("touchend",t)}onContextMenuEvent(t){e.canvas.addEventListener("contextmenu",t)}throttle(t,n){let a=!1;return function(s){a||(t.apply(null,[s]),a=!0,setTimeout(function(){a=!1},n))}}}class q{constructor(t){r(this,"properties");r(this,"worldCenterX");r(this,"worldCenterY");r(this,"radiusX");r(this,"radiusY");this.properties=t,this.worldCenterX=0,this.worldCenterY=0,this.radiusX=0,this.radiusY=0}startDraw(t){e.ctx.strokeStyle=this.properties.strokeColor,e.ctx.lineWidth=this.properties.lineWidth*e.canvasConfig.scale;const n=t instanceof MouseEvent?t.pageX:t.touches[0].pageX,a=t instanceof MouseEvent?t.pageY:t.touches[0].pageY;this.properties.initialX=n,this.properties.initialY=a}draw(t){e.clearCanvas(),e.reDraw(),e.ctx.beginPath();const n=t instanceof MouseEvent?t.pageX:t.touches[0].pageX,a=t instanceof MouseEvent?t.pageY:t.touches[0].pageY;let s=(n-this.properties.initialX)/2,o=(a-this.properties.initialY)/2;if(e.isPerfectShape){const u=Math.min(Math.abs(s),Math.abs(o)),f=s<0?-1:1,d=o<0?-1:1;s=u*f,o=u*d}let l=this.properties.initialX+s,h=this.properties.initialY+o;s=Math.abs(s),o=Math.abs(o),this.worldCenterX=e.canvasConfig.toWorldX(l),this.worldCenterY=e.canvasConfig.toWorldY(h),this.radiusX=s/e.canvasConfig.scale,this.radiusY=o/e.canvasConfig.scale,e.ctx.ellipse(l,h,s,o,0,0,2*Math.PI),e.ctx.stroke(),e.ctx.closePath()}reDraw(){e.ctx.strokeStyle=this.properties.strokeColor,e.ctx.lineWidth=this.properties.lineWidth*e.canvasConfig.scale,e.ctx.ellipse(e.canvasConfig.toScreenX(this.worldCenterX),e.canvasConfig.toScreenY(this.worldCenterY),this.radiusX*e.canvasConfig.scale,this.radiusY*e.canvasConfig.scale,0,0,2*Math.PI),e.ctx.stroke()}cancelDraw(){e.clearCanvas(),e.reDraw()}endDraw(){e.ctx.closePath()}isEmpty(){return this.radiusX===0&&this.radiusY===0}}class b{constructor(t){r(this,"line");r(this,"initialRealX");r(this,"initialRealY");r(this,"properties");this.line=[],this.initialRealX=0,this.initialRealY=0,this.properties=t}cancelDraw(){this.line=[]}startDraw(t){e.ctx.strokeStyle=this.properties.strokeColor,e.ctx.lineWidth=this.properties.lineWidth*e.canvasConfig.scale,e.ctx.lineCap="round",e.ctx.lineJoin="round",e.ctx.beginPath();const n=t instanceof MouseEvent?t.pageX:t.touches[0].pageX,a=t instanceof MouseEvent?t.pageY:t.touches[0].pageY;this.properties.initialX=n,this.properties.initialY=a,this.initialRealX=e.canvasConfig.toWorldX(n),this.initialRealY=e.canvasConfig.toWorldY(a)}draw(t){const n=t instanceof MouseEvent?t.pageX:t.touches[0].pageX,a=t instanceof MouseEvent?t.pageY:t.touches[0].pageY;if(e.clearCanvas(),e.reDraw(),e.ctx.beginPath(),e.isPerfectShape)e.ctx.moveTo(this.properties.initialX,this.properties.initialY),e.ctx.lineTo(n,a);else{let s=[this.initialRealX,this.initialRealY];this.line.push([e.canvasConfig.toWorldX(n),e.canvasConfig.toWorldY(a)]);let o=this.line[0];for(let l=1;l<this.line.length;l++){let h=this.midPoint(s,o);e.ctx.quadraticCurveTo(e.canvasConfig.toScreenX(s[0]),e.canvasConfig.toScreenY(s[1]),e.canvasConfig.toScreenX(h[0]),e.canvasConfig.toScreenY(h[1])),s=this.line[l],o=this.line[l+1]}}e.ctx.stroke(),e.ctx.closePath()}midPoint(t,n){return[t[0]+(n[0]-t[0])/2,t[1]+(n[1]-t[1])/2]}reDraw(){if(this.line.length>2){e.ctx.beginPath();let t=[this.initialRealX,this.initialRealY],n=this.line[0];e.ctx.moveTo(e.canvasConfig.toScreenX(this.initialRealX),e.canvasConfig.toScreenY(this.initialRealY));for(let a=1;a<this.line.length;a++){let s=this.midPoint(t,n);e.ctx.quadraticCurveTo(e.canvasConfig.toScreenX(t[0]),e.canvasConfig.toScreenY(t[1]),e.canvasConfig.toScreenX(s[0]),e.canvasConfig.toScreenY(s[1])),t=this.line[a],n=this.line[a+1]}e.ctx.stroke(),e.ctx.closePath()}else{for(let t=0;t<this.line.length;t++)e.ctx.lineTo(e.canvasConfig.toScreenX(this.line[t][0]),e.canvasConfig.toScreenY(this.line[t][1]));e.ctx.stroke()}}endDraw(t){if(e.isPerfectShape){const n=t instanceof MouseEvent?t.pageX:t.changedTouches[0].pageX,a=t instanceof MouseEvent?t.pageY:t.changedTouches[0].pageY;this.line=[];const s=[e.canvasConfig.toWorldX(n),e.canvasConfig.toWorldY(a)];this.line.push([e.canvasConfig.toWorldX(this.properties.initialX),e.canvasConfig.toWorldY(this.properties.initialY)]),this.line.push(s)}this.line.length>2&&(this.line=this.normalizeArray(this.line)),e.ctx.closePath()}isEmpty(){return this.line.length===0}normalizeArray(t){let n=[];return n=t.filter((a,s)=>{if(s===0)return!0;if(s===t.length-1)return!1;const o=t[s-1];return!(o[0]===a[0]||o[1]===a[1])}),n.push([t[t.length-1][0],t[t.length-1][1]]),n}}class Z{constructor(t){r(this,"properties");r(this,"initialRealX");r(this,"initialRealY");r(this,"width");r(this,"height");this.properties=t,this.initialRealX=0,this.initialRealY=0,this.width=0,this.height=0}startDraw(t){e.ctx.strokeStyle=this.properties.strokeColor,e.ctx.lineWidth=this.properties.lineWidth*e.canvasConfig.scale;const n=t instanceof MouseEvent?t.pageX:t.touches[0].pageX,a=t instanceof MouseEvent?t.pageY:t.touches[0].pageY;this.properties.initialX=n,this.properties.initialY=a,this.initialRealX=e.canvasConfig.toWorldX(n),this.initialRealY=e.canvasConfig.toWorldY(a)}draw(t){e.clearCanvas(),e.reDraw(),e.ctx.beginPath();const n=t instanceof MouseEvent?t.pageX:t.touches[0].pageX,a=t instanceof MouseEvent?t.pageY:t.touches[0].pageY;let s=n-this.properties.initialX,o=a-this.properties.initialY;if(e.isPerfectShape){const l=Math.min(Math.abs(s),Math.abs(o));let h=o<0?-1:1,u=s<0?-1:1;s=l*u,o=l*h}this.width=s/e.canvasConfig.scale,this.height=o/e.canvasConfig.scale,e.ctx.rect(this.properties.initialX,this.properties.initialY,s,o),e.ctx.stroke(),e.ctx.closePath()}reDraw(){e.ctx.strokeStyle=this.properties.strokeColor,e.ctx.lineWidth=this.properties.lineWidth*e.canvasConfig.scale,e.ctx.rect(e.canvasConfig.toScreenX(this.initialRealX),e.canvasConfig.toScreenY(this.initialRealY),this.width*e.canvasConfig.scale,this.height*e.canvasConfig.scale),e.ctx.stroke()}cancelDraw(){e.clearCanvas(),e.reDraw()}endDraw(){e.ctx.closePath()}isEmpty(){return this.width===0&&this.height===0}}class F{static create(t,n){switch(t){case g.HandDrawing:return new b(n);case g.Rectangle:return new Z(n);case g.Circle:return new q(n);default:return new b(n)}}}var g=(c=>(c[c.HandDrawing=0]="HandDrawing",c[c.Rectangle=1]="Rectangle",c[c.Circle=2]="Circle",c))(g||{});const J={pen:g.HandDrawing,rectangle:g.Rectangle,circle:g.Circle},j=(c,t)=>{let n=c.parentElement;for(;n!==null;){if(n.tagName===t)return n;n=n.parentElement}return c};let w="#000000",Y=10,G="#000000",S=g.HandDrawing;const Q=()=>{document.getElementById("size").addEventListener("change",n=>{const a=n.target,s=a.nextElementSibling;s.textContent=a.value,Y=Number(a.value)}),document.getElementById("color").addEventListener("change",({target:n})=>{w=n.value}),document.getElementById("clear").addEventListener("click",()=>{e.clearBoard()}),document.getElementById("undo").addEventListener("click",()=>{e.undo()});const c=document.getElementById("download");c.addEventListener("click",()=>{c.setAttribute("download","image.png"),c.setAttribute("href",e.canvas.toDataURL("image/png"))}),document.getElementById("drawables").addEventListener("click",n=>{let a=n.target;a.tagName!=="BUTTON"&&(a=j(a,"BUTTON"));const s=a.dataset.type;s!==void 0&&(S=J[s])})};class T{constructor(){r(this,"offsetX");r(this,"offsetY");r(this,"cursorX");r(this,"cursorY");r(this,"prevCursorX");r(this,"prevCursorY");r(this,"scale");r(this,"prevTouches",[null,null]);this.offsetX=0,this.offsetY=0,this.cursorX=0,this.cursorY=0,this.prevCursorX=0,this.prevCursorY=0,this.scale=1}static get getInstance(){return this._instance||(this._instance=new this)}toScreenX(t){return(t+this.offsetX)*this.scale}toScreenY(t){return(t+this.offsetY)*this.scale}toWorldX(t){return t/this.scale-this.offsetX}toWorldY(t){return t/this.scale-this.offsetY}getWidth(){return e.canvas.clientWidth/this.scale}getHeight(){return e.canvas.clientHeight/this.scale}}r(T,"_instance");const i=class extends O{constructor(){super();r(this,"isDrawing");r(this,"isDragging");r(this,"timer",0);r(this,"currentDraw",null);i.canvas=document.getElementById("canvas"),i.ctx=i.canvas.getContext("2d"),i.canvas.width=document.body.clientWidth,i.canvas.height=document.body.clientHeight,this.isDrawing=!1,this.isDragging=!1,Q(),i.canvasConfig=T.getInstance,this.createDrawable(),i.clearCanvas()}initilizeEvents(){this.onResizeEvent(this.onResize.bind(this)),this.onMouseDownEvent(this.onMouseDown.bind(this)),this.onMouseMoveEvent(this.onMouseMove.bind(this)),this.onMouseUpEvent(this.onMouseUp.bind(this)),this.onMouseLeaveEvent(this.onMouseUp.bind(this)),this.onContextMenuEvent(this.onContextMenu.bind(this)),this.onWheelEvent(this.onMouseWheel.bind(this)),this.onTouchStartEvent(this.onTouchStart.bind(this)),this.onTouchMoveEvent(this.onTouchMove.bind(this)),this.onTouchEndEvent(this.onTouchEnd.bind(this)),this.onKeydownEvent(this.onKeyDown.bind(this))}onContextMenu(n){n.preventDefault()}onResize(){i.canvas.width=document.body.clientWidth,i.canvas.height=document.body.clientHeight,i.reDraw()}static reDraw(){i.history.length!=0&&(i.clearCanvas(),i.history.forEach(n=>{i.ctx.strokeStyle=n.properties.strokeColor,i.ctx.lineWidth=n.properties.lineWidth*i.canvasConfig.scale,i.ctx.moveTo(n.properties.initialX,n.properties.initialY),i.ctx.beginPath(),n.reDraw(),i.ctx.closePath()}),i.ctx.strokeStyle=w,i.ctx.lineWidth=Y*i.canvasConfig.scale)}draw(n){var a;this.isDrawing&&(clearTimeout(this.timer),i.isPerfectShape||(this.timer=setTimeout(()=>{var s;i.isPerfectShape=!0,(s=this.currentDraw)==null||s.draw(n)},1e3)),(a=this.currentDraw)==null||a.draw(n))}endDraw(n){var a,s;this.isDrawing&&((a=this.currentDraw)==null||a.endDraw(n),(s=this.currentDraw)!=null&&s.isEmpty()||i.history.push(this.currentDraw)),console.log(i.history),this.isDrawing=!1,this.isDragging=!1,i.isPerfectShape=!1,clearTimeout(this.timer)}onMouseDown(n){var a;n.preventDefault(),this.isDrawing=n.button==0,this.isDragging=n.button==1,i.canvasConfig.cursorX=n.pageX,i.canvasConfig.cursorY=n.pageY,i.canvasConfig.prevCursorX=n.pageX,i.canvasConfig.prevCursorY=n.pageY,this.isDrawing&&(this.createDrawable(),(a=this.currentDraw)==null||a.startDraw(n))}onMouseMove(n){i.canvasConfig.cursorX=n.pageX,i.canvasConfig.cursorY=n.pageY,this.draw(n),this.isDragging&&(i.canvasConfig.offsetX+=(i.canvasConfig.cursorX-i.canvasConfig.prevCursorX)/i.canvasConfig.scale,i.canvasConfig.offsetY+=(i.canvasConfig.cursorY-i.canvasConfig.prevCursorY)/i.canvasConfig.scale,i.reDraw()),i.canvasConfig.prevCursorX=i.canvasConfig.cursorX,i.canvasConfig.prevCursorY=i.canvasConfig.cursorY}onMouseUp(n){this.endDraw(n)}onMouseWheel(n){var p;if(this.isDrawing){(p=this.currentDraw)==null||p.cancelDraw(),this.createDrawable(),this.isDrawing=!1,this.isDragging=!1;return}const s=-n.deltaY/500,o=i.canvasConfig.scale*(1+s);if(o<.1||o>10)return;i.canvasConfig.scale=o;var l=n.pageX/i.canvas.clientWidth,h=n.pageY/i.canvas.clientHeight;const u=i.canvasConfig.getWidth()*s,f=i.canvasConfig.getHeight()*s,d=u*l,v=f*h;i.canvasConfig.offsetX-=d,i.canvasConfig.offsetY-=v,i.reDraw()}onTouchStart(n){var a;this.isDrawing=n.touches.length==1,this.isDragging=n.touches.length>=2,i.canvasConfig.prevTouches[0]=n.touches[0],i.canvasConfig.prevTouches[1]=n.touches[1],this.createDrawable(),(a=this.currentDraw)==null||a.startDraw(n)}onTouchMove(n){var d,v,p;if(i.canvasConfig.prevTouches[0]===null||i.canvasConfig.prevTouches[1]===null)return;const a=n.touches[0].pageX,s=n.touches[0].pageY,o=i.canvasConfig.prevTouches[0].pageX,l=i.canvasConfig.prevTouches[0].pageY;if(this.draw(n),this.isDragging){if(this.isDrawing){(d=this.currentDraw)==null||d.cancelDraw(),this.createDrawable(),this.isDrawing=!1,this.isDragging=!1;return}n.preventDefault();const X=n.touches[1].pageX,D=n.touches[1].pageY,m=(v=i.canvasConfig.prevTouches[1])==null?void 0:v.pageX,E=(p=i.canvasConfig.prevTouches[1])==null?void 0:p.pageY,y=(a+X)/2,x=(s+D)/2,W=(o+m)/2,R=(l+E)/2,P=Math.sqrt(Math.pow(a-X,2)+Math.pow(s-D,2)),k=Math.sqrt(Math.pow(o-m,2)+Math.pow(l-E,2));var h=P/k;const C=i.canvasConfig.scale*h;if(C<.1||C>10)return;i.canvasConfig.scale=C;const M=1-h,L=y-W,H=x-R;i.canvasConfig.offsetX+=L/i.canvasConfig.scale,i.canvasConfig.offsetY+=H/i.canvasConfig.scale;var u=y/i.canvas.clientWidth,f=x/i.canvas.clientHeight;const I=i.canvasConfig.getWidth()*M,z=i.canvasConfig.getHeight()*M,A=I*u,U=z*f;i.canvasConfig.offsetX+=A,i.canvasConfig.offsetY+=U,i.reDraw()}i.canvasConfig.prevTouches[0]=n.touches[0],i.canvasConfig.prevTouches[1]=n.touches[1]}onTouchEnd(n){this.endDraw(n),i.canvasConfig.prevTouches[0]=null,i.canvasConfig.prevTouches[1]=null}onKeyDown(n){n.ctrlKey&&(n.key===""||n.key==="z")&&i.undo()}static undo(){i.history.length!==0&&(i.clearCanvas(),i.history.pop(),i.reDraw())}static clearBoard(){i.clearCanvas(),i.history=[]}createDrawable(){this.currentDraw=F.create(S,{strokeColor:w,lineWidth:Y})}static clearCanvas(n=null){i.ctx.fillStyle="#fff",n===null?i.ctx.fillRect(0,0,document.body.clientWidth,document.body.clientHeight):i.ctx.fillRect(n.prevX,n.prevY,n.x,n.y),i.ctx.fillStyle=G}};let e=i;r(e,"canvas"),r(e,"ctx"),r(e,"isPerfectShape",!1),r(e,"history",[]),r(e,"canvasConfig");const V=new e;V.initilizeEvents();

var B=Object.defineProperty;var K=(c,e,t)=>e in c?B(c,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):c[e]=t;var r=(c,e,t)=>(K(c,typeof e!="symbol"?e+"":e,t),t);const O=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))a(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const h of o.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&a(h)}).observe(document,{childList:!0,subtree:!0});function t(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerpolicy&&(o.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?o.credentials="include":i.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function a(i){if(i.ep)return;i.ep=!0;const o=t(i);fetch(i.href,o)}};O();class Z{constructor(){r(this,"throttleTime",10)}onResizeEvent(e){window.addEventListener("resize",e)}onKeydownEvent(e){window.addEventListener("keydown",e)}onKeyupEvent(e){window.addEventListener("keyup",e)}onKeypressEvent(e){window.addEventListener("keypress",e)}onMouseDownEvent(e){n.canvas.addEventListener("mousedown",e)}onMouseMoveEvent(e){n.canvas.addEventListener("mousemove",this.throttle(e,this.throttleTime))}onMouseUpEvent(e){n.canvas.addEventListener("mouseup",e)}onMouseLeaveEvent(e){n.canvas.addEventListener("mouseleave",e)}onWheelEvent(e){n.canvas.addEventListener("wheel",e)}onTouchStartEvent(e){n.canvas.addEventListener("touchstart",e)}onTouchMoveEvent(e){n.canvas.addEventListener("touchmove",this.throttle(e,this.throttleTime))}onTouchEndEvent(e){n.canvas.addEventListener("touchend",e)}onContextMenuEvent(e){n.canvas.addEventListener("contextmenu",e)}throttle(e,t){let a=!1;return function(i){a||(e.apply(null,[i]),a=!0,setTimeout(function(){a=!1},t))}}}class q{constructor(e){r(this,"properties");r(this,"worldCenterX");r(this,"worldCenterY");r(this,"radiusX");r(this,"radiusY");this.properties=e,this.worldCenterX=0,this.worldCenterY=0,this.radiusX=0,this.radiusY=0}startDraw(e){n.ctx.strokeStyle=this.properties.strokeColor,n.ctx.lineWidth=this.properties.lineWidth*n.canvasConfig.scale;const t=e instanceof MouseEvent?e.pageX:e.touches[0].pageX,a=e instanceof MouseEvent?e.pageY:e.touches[0].pageY;this.properties.initialX=t,this.properties.initialY=a}draw(e){n.clearCanvas(),n.reDraw(),n.ctx.beginPath();const t=e instanceof MouseEvent?e.pageX:e.touches[0].pageX,a=e instanceof MouseEvent?e.pageY:e.touches[0].pageY;let i=(t-this.properties.initialX)/2,o=(a-this.properties.initialY)/2;if(n.isPerfectShape){const u=Math.min(i<0?Math.abs(i):i,o<0?Math.abs(o):o),f=i<0?-1:1,d=o<0?-1:1;i=u*f,o=u*d}let h=this.properties.initialX+i,l=this.properties.initialY+o;i=Math.abs(i),o=Math.abs(o),this.worldCenterX=n.canvasConfig.toWorldX(h),this.worldCenterY=n.canvasConfig.toWorldY(l),this.radiusX=i/n.canvasConfig.scale,this.radiusY=o/n.canvasConfig.scale,n.ctx.ellipse(h,l,i,o,0,0,2*Math.PI),n.ctx.stroke(),n.ctx.closePath()}reDraw(){n.ctx.strokeStyle=this.properties.strokeColor,n.ctx.lineWidth=this.properties.lineWidth*n.canvasConfig.scale,n.ctx.ellipse(n.canvasConfig.toScreenX(this.worldCenterX),n.canvasConfig.toScreenY(this.worldCenterY),this.radiusX*n.canvasConfig.scale,this.radiusY*n.canvasConfig.scale,0,0,2*Math.PI),n.ctx.stroke()}cancelDraw(){n.clearCanvas(),n.reDraw()}endDraw(){n.ctx.closePath()}isEmpty(){return this.radiusX===0&&this.radiusY===0}}class T{constructor(e){r(this,"line");r(this,"prevX",0);r(this,"prevY",0);r(this,"properties");this.line=[],this.properties=e}cancelDraw(){this.line=[]}startDraw(e){n.ctx.strokeStyle=this.properties.strokeColor,n.ctx.lineWidth=this.properties.lineWidth*n.canvasConfig.scale,n.ctx.lineCap="round",n.ctx.lineJoin="round",n.ctx.beginPath();const t=e instanceof MouseEvent?e.pageX:e.touches[0].pageX,a=e instanceof MouseEvent?e.pageY:e.touches[0].pageY;this.properties.initialX=t,this.properties.initialY=a}draw(e){const t=e instanceof MouseEvent?e.pageX:e.touches[0].pageX,a=e instanceof MouseEvent?e.pageY:e.touches[0].pageY;if(n.isPerfectShape)n.clearCanvas(),n.reDraw(),n.ctx.beginPath(),n.ctx.moveTo(this.properties.initialX,this.properties.initialY),n.ctx.lineTo(t,a),n.ctx.closePath();else{const i=[n.canvasConfig.toWorldX(t),n.canvasConfig.toWorldY(a)];n.ctx.lineTo(t,a),this.line.push(i)}n.ctx.stroke()}reDraw(){for(let e=0;e<this.line.length;e++)n.ctx.lineTo(n.canvasConfig.toScreenX(this.line[e][0]),n.canvasConfig.toScreenY(this.line[e][1]));n.ctx.stroke()}endDraw(e){if(n.isPerfectShape){const t=e instanceof MouseEvent?e.pageX:e.touches[0].pageX,a=e instanceof MouseEvent?e.pageY:e.touches[0].pageY;this.line=[];const i=[n.canvasConfig.toWorldX(t),n.canvasConfig.toWorldY(a)];this.line.push([n.canvasConfig.toWorldX(this.properties.initialX),n.canvasConfig.toWorldY(this.properties.initialY)]),this.line.push(i)}this.line.length>2&&(this.line=this.normalizeArray(this.line)),n.ctx.closePath()}isEmpty(){return this.line.length===0}normalizeArray(e){let t=[];return t=e.filter((a,i)=>{if(i===0)return!0;if(i===e.length-1)return!1;const o=e[i-1];return!(o[0]===a[0]||o[1]===a[1])}),t.push([e[e.length-1][0],e[e.length-1][1]]),t}}class F{constructor(e){r(this,"properties");r(this,"initialRealX");r(this,"initialRealY");r(this,"width");r(this,"height");this.properties=e,this.initialRealX=0,this.initialRealY=0,this.width=0,this.height=0}startDraw(e){n.ctx.strokeStyle=this.properties.strokeColor,n.ctx.lineWidth=this.properties.lineWidth*n.canvasConfig.scale;const t=e instanceof MouseEvent?e.pageX:e.touches[0].pageX,a=e instanceof MouseEvent?e.pageY:e.touches[0].pageY;this.properties.initialX=t,this.properties.initialY=a,this.initialRealX=n.canvasConfig.toWorldX(t),this.initialRealY=n.canvasConfig.toWorldY(a)}draw(e){n.clearCanvas(),n.reDraw(),n.ctx.beginPath();const t=e instanceof MouseEvent?e.pageX:e.touches[0].pageX,a=e instanceof MouseEvent?e.pageY:e.touches[0].pageY;let i=t-this.properties.initialX,o=a-this.properties.initialY;if(n.isPerfectShape){const h=Math.min(i<0?Math.abs(i):i,o<0?Math.abs(o):o);let l=o<0?-1:1,u=i<0?-1:1;i=h*u,o=h*l}this.width=i/n.canvasConfig.scale,this.height=o/n.canvasConfig.scale,n.ctx.rect(this.properties.initialX,this.properties.initialY,i,o),n.ctx.stroke(),n.ctx.closePath()}reDraw(){n.ctx.strokeStyle=this.properties.strokeColor,n.ctx.lineWidth=this.properties.lineWidth*n.canvasConfig.scale,n.ctx.rect(n.canvasConfig.toScreenX(this.initialRealX),n.canvasConfig.toScreenY(this.initialRealY),this.width*n.canvasConfig.scale,this.height*n.canvasConfig.scale),n.ctx.stroke()}cancelDraw(){n.clearCanvas(),n.reDraw()}endDraw(){n.ctx.closePath()}isEmpty(){return this.width===0&&this.height===0}}class J{static create(e,t){switch(e){case g.HandDrawing:return new T(t);case g.Rectangle:return new F(t);case g.Circle:return new q(t);default:return new T(t)}}}var g=(c=>(c[c.HandDrawing=0]="HandDrawing",c[c.Rectangle=1]="Rectangle",c[c.Circle=2]="Circle",c))(g||{});const j={pen:g.HandDrawing,rectangle:g.Rectangle,circle:g.Circle},G=(c,e)=>{let t=c.parentElement;for(;t!==null;){if(t.tagName===e)return t;t=t.parentElement}return c};let C="#000000",Y=10,Q="#000000",W=g.HandDrawing;const V=()=>{document.getElementById("size").addEventListener("change",t=>{const a=t.target,i=a.nextElementSibling;i.textContent=a.value,Y=Number(a.value)}),document.getElementById("color").addEventListener("change",({target:t})=>{C=t.value}),document.getElementById("clear").addEventListener("click",()=>{n.clearBoard()}),document.getElementById("undo").addEventListener("click",()=>{n.undo()});const c=document.getElementById("download");c.addEventListener("click",()=>{c.setAttribute("download","image.png"),c.setAttribute("href",n.canvas.toDataURL("image/png"))}),document.getElementById("drawables").addEventListener("click",t=>{let a=t.target;a.tagName!=="BUTTON"&&(a=G(a,"BUTTON"));const i=a.dataset.type;i!==void 0&&(W=j[i])})};class S{constructor(){r(this,"offsetX");r(this,"offsetY");r(this,"cursorX");r(this,"cursorY");r(this,"prevCursorX");r(this,"prevCursorY");r(this,"scale");r(this,"prevTouches",[null,null]);this.offsetX=0,this.offsetY=0,this.cursorX=0,this.cursorY=0,this.prevCursorX=0,this.prevCursorY=0,this.scale=1}static get getInstance(){return this._instance||(this._instance=new this)}toScreenX(e){return(e+this.offsetX)*this.scale}toScreenY(e){return(e+this.offsetY)*this.scale}toWorldX(e){return e/this.scale-this.offsetX}toWorldY(e){return e/this.scale-this.offsetY}getWidth(){return n.canvas.clientWidth/this.scale}getHeight(){return n.canvas.clientHeight/this.scale}}r(S,"_instance");const s=class extends Z{constructor(){super();r(this,"isDrawing");r(this,"isDragging");r(this,"timer",0);r(this,"currentDraw",null);s.canvas=document.getElementById("canvas"),s.ctx=s.canvas.getContext("2d"),s.canvas.width=document.body.clientWidth,s.canvas.height=document.body.clientHeight,this.isDrawing=!1,this.isDragging=!1,V(),s.canvasConfig=S.getInstance,this.createDrawable(),s.clearCanvas()}initilizeEvents(){this.onResizeEvent(this.onResize.bind(this)),this.onMouseDownEvent(this.onMouseDown.bind(this)),this.onMouseMoveEvent(this.onMouseMove.bind(this)),this.onMouseUpEvent(this.onMouseUp.bind(this)),this.onMouseLeaveEvent(this.onMouseUp.bind(this)),this.onContextMenuEvent(this.onContextMenu.bind(this)),this.onWheelEvent(this.onMouseWheel.bind(this)),this.onTouchStartEvent(this.onTouchStart.bind(this)),this.onTouchMoveEvent(this.onTouchMove.bind(this)),this.onTouchEndEvent(this.onTouchEnd.bind(this)),this.onKeydownEvent(this.onKeyDown.bind(this))}onContextMenu(t){t.preventDefault()}onResize(){s.canvas.width=document.body.clientWidth,s.canvas.height=document.body.clientHeight,s.reDraw()}static reDraw(){s.history.length!=0&&(s.clearCanvas(),s.history.forEach(t=>{s.ctx.strokeStyle=t.properties.strokeColor,s.ctx.lineWidth=t.properties.lineWidth*s.canvasConfig.scale,s.ctx.moveTo(t.properties.initialX,t.properties.initialY),s.ctx.beginPath(),t.reDraw(),s.ctx.closePath()}),s.ctx.strokeStyle=C,s.ctx.lineWidth=Y*s.canvasConfig.scale)}draw(t){var a;this.isDrawing&&(clearTimeout(this.timer),s.isPerfectShape||(this.timer=setTimeout(()=>{var i;s.isPerfectShape=!0,(i=this.currentDraw)==null||i.draw(t),console.log("perfect")},1e3)),(a=this.currentDraw)==null||a.draw(t))}endDraw(t){var a,i;this.isDrawing&&((a=this.currentDraw)==null||a.endDraw(t),(i=this.currentDraw)!=null&&i.isEmpty()||s.history.push(this.currentDraw)),this.isDrawing=!1,this.isDragging=!1,s.isPerfectShape=!1,clearTimeout(this.timer)}onMouseDown(t){var a;t.preventDefault(),this.isDrawing=t.button==0,this.isDragging=t.button==1,s.canvasConfig.cursorX=t.pageX,s.canvasConfig.cursorY=t.pageY,s.canvasConfig.prevCursorX=t.pageX,s.canvasConfig.prevCursorY=t.pageY,this.isDrawing&&(this.createDrawable(),(a=this.currentDraw)==null||a.startDraw(t))}onMouseMove(t){s.canvasConfig.cursorX=t.pageX,s.canvasConfig.cursorY=t.pageY,this.draw(t),this.isDragging&&(s.canvasConfig.offsetX+=(s.canvasConfig.cursorX-s.canvasConfig.prevCursorX)/s.canvasConfig.scale,s.canvasConfig.offsetY+=(s.canvasConfig.cursorY-s.canvasConfig.prevCursorY)/s.canvasConfig.scale,s.reDraw()),s.canvasConfig.prevCursorX=s.canvasConfig.cursorX,s.canvasConfig.prevCursorY=s.canvasConfig.cursorY}onMouseUp(t){this.endDraw(t)}onMouseWheel(t){var p;if(this.isDrawing){(p=this.currentDraw)==null||p.cancelDraw(),this.createDrawable(),this.isDrawing=!1,this.isDragging=!1;return}const i=-t.deltaY/500,o=s.canvasConfig.scale*(1+i);if(o<.1||o>10)return;s.canvasConfig.scale=o;var h=t.pageX/s.canvas.clientWidth,l=t.pageY/s.canvas.clientHeight;const u=s.canvasConfig.getWidth()*i,f=s.canvasConfig.getHeight()*i,d=u*h,v=f*l;s.canvasConfig.offsetX-=d,s.canvasConfig.offsetY-=v,s.reDraw()}onTouchStart(t){var a;this.isDrawing=t.touches.length==1,this.isDragging=t.touches.length>=2,s.canvasConfig.prevTouches[0]=t.touches[0],s.canvasConfig.prevTouches[1]=t.touches[1],this.createDrawable(),(a=this.currentDraw)==null||a.startDraw(t)}onTouchMove(t){var d,v,p,X;if(s.canvasConfig.prevTouches[0]===null||s.canvasConfig.prevTouches[1]===null)return;const a=t.touches[0].pageX,i=t.touches[0].pageY,o=s.canvasConfig.prevTouches[0].pageX,h=s.canvasConfig.prevTouches[0].pageY;if(this.isDrawing&&((d=this.currentDraw)==null||d.draw(t)),this.isDragging){if(this.isDrawing){(v=this.currentDraw)==null||v.cancelDraw(),this.createDrawable(),this.isDrawing=!1,this.isDragging=!1;return}t.preventDefault();const D=t.touches[1].pageX,E=t.touches[1].pageY,m=(p=s.canvasConfig.prevTouches[1])==null?void 0:p.pageX,y=(X=s.canvasConfig.prevTouches[1])==null?void 0:X.pageY,x=(a+D)/2,M=(i+E)/2,k=(o+m)/2,L=(h+y)/2,P=Math.sqrt(Math.pow(a-D,2)+Math.pow(i-E,2)),R=Math.sqrt(Math.pow(o-m,2)+Math.pow(h-y,2));var l=P/R;const w=s.canvasConfig.scale*l;if(w<.1||w>10)return;s.canvasConfig.scale=w;const b=1-l,H=x-k,I=M-L;s.canvasConfig.offsetX+=H/s.canvasConfig.scale,s.canvasConfig.offsetY+=I/s.canvasConfig.scale;var u=x/s.canvas.clientWidth,f=M/s.canvas.clientHeight;const z=s.canvasConfig.getWidth()*b,A=s.canvasConfig.getHeight()*b,U=z*u,N=A*f;s.canvasConfig.offsetX+=U,s.canvasConfig.offsetY+=N,s.reDraw()}s.canvasConfig.prevTouches[0]=t.touches[0],s.canvasConfig.prevTouches[1]=t.touches[1]}onTouchEnd(t){this.endDraw(t),s.canvasConfig.prevTouches[0]=null,s.canvasConfig.prevTouches[1]=null}onKeyDown(t){t.ctrlKey&&(t.key===""||t.key==="z")&&s.undo()}static undo(){s.history.length!==0&&(s.clearCanvas(),s.history.pop(),s.reDraw())}static clearBoard(){s.clearCanvas(),s.history=[]}createDrawable(){this.currentDraw=J.create(W,{strokeColor:C,lineWidth:Y})}static clearCanvas(t=null){s.ctx.fillStyle="#fff",t===null?s.ctx.fillRect(0,0,document.body.clientWidth,document.body.clientHeight):s.ctx.fillRect(t.prevX,t.prevY,t.x,t.y),s.ctx.fillStyle=Q}};let n=s;r(n,"canvas"),r(n,"ctx"),r(n,"isPerfectShape",!1),r(n,"history",[]),r(n,"canvasConfig");const $=new n;$.initilizeEvents();
